<!doctype html><html lang=en-us><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://immatt2015.github.io/css/frameworks.css><link crossorigin=anonymous media=all rel=stylesheet href=https://immatt2015.github.io/css/github.css><link crossorigin=anonymous media="(prefers-color-scheme: dark)" rel=stylesheet href=https://immatt2015.github.io/css/dark.css><meta name=viewport content="width=device-width"><meta name=description content><meta name=keywords content="blog,google analytics"><meta name=robots content="noodp"><link rel=canonical href=https://immatt2015.github.io/posts/><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts - My Blog"><meta name=twitter:description content><meta name=twitter:site content="https://immatt2015.github.io/"><meta name=twitter:creator content><meta name=twitter:image content="https://immatt2015.github.io/"><meta property="og:type" content="website"><meta property="og:title" content="Posts - My Blog"><meta property="og:description" content><meta property="og:url" content="https://immatt2015.github.io/posts/"><meta property="og:site_name" content="Posts"><meta property="og:image" content="https://immatt2015.github.io/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><link href=/posts/index.xml rel=alternate type=application/rss+xml title="My Blog"><title>Posts - My Blog</title><link rel=icon type=image/x-icon class=js-site-favicon href=https://immatt2015.github.io/images/favicon.ico><meta name=theme-color content="#1e2327"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-159916317-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://immatt2015.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://immatt2015.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex"><details class="details-overlay details-reset"><summary class=Header-link aria-label="View profile and more" data-ga-click="Header, show menu, icon:avatar"><img alt class=avatar src=/images/wl.png height=20 width=20></summary></details></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><main><div class="container-xl clearfix px-3 mt-4"><div class="h-card col-lg-3 col-md-4 col-12 float-md-left pr-md-3 pr-xl-6" itemscope itemtype=http://schema.org/Person><div class="user-profile-sticky-bar js-user-profile-sticky-bar"></div><div class="clearfix mb-2"><div class="float-left col-3 col-md-12 pr-3 pr-md-0"><a itemprop=image class="u-photo d-block position-relative" aria-hidden=true href=/images/wl.png><img alt width=260 height=260 class="avatar width-full height-full rounded-2" src=/images/wl.png></a></div><div class="float-left col-9 col-md-12 pl-2 pl-md-0"><div class="vcard-names-container pt-1 pt-md-3 pb-1 pb-md-3 js-sticky js-user-profile-sticky-fields"><h1 class=vcard-names><span class="p-name vcard-fullname d-block overflow-hidden" itemprop=name>Matt</span>
<span class="p-nickname vcard-username d-block" itemprop=additionalName>example</span></h1></div><div class="d-none d-md-block"><div class=js-profile-editable-area><div class="p-note user-profile-bio js-user-profile-bio"><div>my-blog</div></div><ul class="vcard-details mb-3"><li itemprop=url data-test-selector=profile-website-url class="vcard-detail pt-1 css-truncate css-truncate-target"><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg><a rel="nofollow me" href=https://immatt2015.github.io/>https://immatt2015.github.io/</a></li></ul></div></div><div class="border-top py-3 clearfix hide-sm hide-md"><h2 class="mb-1 h4">Organizations</h2><a class=avatar-group-item data-hovercard-type=organization href=https://github.com/example><svg width="35" height="35" class="avatar github-octicon" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><a class=avatar-group-item data-hovercard-type=organization href=https://immatt2015.github.io/posts/index.xml><img src=https://immatt2015.github.io/images/rss.png class=avatar width=38 height=38></a></div><div data-test-selector=profile-sponsorships></div></div></div></div><div class="col-lg-9 col-md-8 col-12 float-md-left pl-md-2"><div class="UnderlineNav width-full user-profile-nav top-0 is-placeholder" style=visibility:hidden;display:none;height:56px></div><div class="UnderlineNav width-full user-profile-nav js-sticky top-0" style=position:static;top:0;left:330.5px;width:911.5px><nav class=UnderlineNav-body aria-label="User profile"><a aria-current=page class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3" href=https://immatt2015.github.io/>Overview</a>
<a class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3 selected" href=https://immatt2015.github.io/posts/>Posts
<span class="Counter hide-lg hide-md hide-sm">4</span></a>
<a class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3" href=https://immatt2015.github.io/about/>About</a></nav></div><div class=position-relative><div id=user-repositories-list><ul data-filterable-for=your-repos-filter data-filterable-type=substring><li class="col-12 d-flex width-full py-4 border-bottom public fork"><div class="col-12 col-lg-12 d-inline-block"><div class="d-inline-block mb-1"><h3><a href=https://immatt2015.github.io/posts/tunnel/openvpn/>OpenVPN 部署以及在 openwrt 上搭透明代理</a></h3></div><div name=posts-post class="text-gray mb-2 pr-4">本文主要介绍的是 openvpn 部署过程 以及在 openwrt 搞透明全局代理
vps 系统类型： Centos7
vps 主要执行：
安装 openvpn 并设置 打开ipv4数据包转发 防火墙允许包转发 添加用户 服务器 添加EPEL源, 并执行更新
yum install epel-release -y && yum update -y && yum upgrade -y 安装openvpn 以及 工具
yum -y install openvpn easy-rsa 生成密钥 复制配置文件 cd /usr/share/easy-rsa/3 cp /usr/share/doc/easy-rsa-${ easy-rsa 版本号 }/vars.example vars
修改 var 项目
#set_var EASYRSA_REQ_COUNTRY "US" #set_var EASYRSA_REQ_PROVINCE "California" #set_var EASYRSA_REQ_CITY "San Francisco" #set_var EASYRSA_REQ_ORG "Copyleft Certificate Co" #set_var EASYRSA_REQ_EMAIL "me@example.</div><div class="f6 text-gray mt-2">Updated <relative-time datetime=2020-05-28 class=no-wrap title="Modifyd at 2020/05/28">May 28, 2020</relative-time></div></div></li><li class="col-12 d-flex width-full py-4 border-bottom public fork"><div class="col-12 col-lg-12 d-inline-block"><div class="d-inline-block mb-1"><h3><a href=https://immatt2015.github.io/posts/nginx/geoip/>Openresty GeoIp 使用</a></h3></div><div name=posts-post class="text-gray mb-2 pr-4">安装过程:
到 maxmind 站点注册个账号
vps 安装
yum install libmaxminddb libmaxminddb-devel perl-Digest-MD5 安装 openresty 第三方包 opm get anjia0532/lua-resty-maxminddb
openresty 配置文件, 进行初始化
# init_by_lua_block { local geo = require 'resty.maxminddb' if not geo.initted() then geo.init("$GeoLite2.mmdb 路径") end } 可以在其他的 lua 执行节点使用
local geo = require 'resty.maxminddb' local res, err = geo.lookup($ip) 免费库精准度一般； 测试发现很大的误差·······</div><div class="f6 text-gray mt-2">Updated <relative-time datetime=2020-05-28 class=no-wrap title="Modifyd at 2020/05/28">May 28, 2020</relative-time></div></div></li><li class="col-12 d-flex width-full py-4 border-bottom public fork"><div class="col-12 col-lg-12 d-inline-block"><div class="d-inline-block mb-1"><h3><a href=https://immatt2015.github.io/posts/tunnel/trojan/>Trojan部署</a></h3></div><div name=posts-post class="text-gray mb-2 pr-4">Trojan 搭建只要分为4步.
准备VPS， 并装好 openresty/nginx， 开放端口 80， 443； 准备一个域名 https 证书 使用 trojan 域名 域名可以使用免费域名 dynu ddns, 注册一下， 然后到对应界面添加一个域名。
证书 参考 www.jouypub.com 可以使用 Let’s Encrypt 免费证书。 使用 certbot 签发免费证书，centos7 为例子:
安装 certbot
yum install certbot 创建好对应目录
cd /usr/local/openresty/nginx/html/; mkdir .well-known // openresty 默认路径 在 nginx 80端口设置好 well-know 访问路径
location /.well-known/ { root /usr/local/openresty/nginx/html; } 使用certbot 签发证书, 会提示邮箱地址，这个随意填</div><div class="f6 text-gray mt-2">Updated <relative-time datetime=2020-05-28 class=no-wrap title="Modifyd at 2020/05/28">May 28, 2020</relative-time></div></div></li><li class="col-12 d-flex width-full py-4 border-bottom public fork"><div class="col-12 col-lg-12 d-inline-block"><div class="d-inline-block mb-1"><h3><a href=https://immatt2015.github.io/posts/nginx/njs/>为 Nginx/Openresty 添加 nginx Njs</a></h3></div><div name=posts-post class="text-gray mb-2 pr-4">njs 是可以 javascrip 编写 nginx 处理逻辑。
njs 可以通过编译成 dynamic module 添加到 nginx/openresty ；
编译的过程:
到 http://hg.nginx.org/njs 下载 njs 代码; 进入 nginx/openrety 的源码目录 ./configurate --add-dynamical-module=/xxxx/njs_root_path/nginx ，参数为 njs 源码目录下的 nginx 目录的绝对路径 在 nginx/openresty 源码根路径下执行 make 第4步执行完后， 执行 make install 在 nginx.conf 下配置 njs 动态模块; nginx.conf worker_processes 1; load_module /usr/local/openresty/nginx/modules/ngx_http_js_module.so; # openrety 默认路径 events { worker_connections 1024; } http { js_include http.js; server { listen 80; error_log /usr/local/openresty/nginx/logs/e.log; location / { js_content foo; } } } /usr/local/openresty/nginx/conf/http.</div><div class="f6 text-gray mt-2">Updated <relative-time datetime=2020-05-27 class=no-wrap title="Modifyd at 2020/05/27">May 27, 2020</relative-time></div></div></li></ul></div></div></div></main></div><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2019. Theme by <a href=https://github.com/MeiK2333/github-style><span>github-style</span></a></a></li></ul><a aria-label=Homepage title="My Blog" class="footer-octicon d-none d-lg-block mx-lg-4" href=https://immatt2015.github.io/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://immatt2015.github.io/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://immatt2015.github.io/js/github-bootstrap.js></script><script src=https://immatt2015.github.io/js/stop.js></script><script src=https://immatt2015.github.io/js/contributions.js></script></body></html>